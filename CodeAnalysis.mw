== CodeAnalysis (e680-linux) ==


This is currently work in progress

Changes made by Motorola to MVista kernel

(MV kernel = 2.4.17/20 kernel + Igno Molnar scheduling changes + XIP + range of MV drivers)


{| border="1" cellpadding="2"
!width="150"|kernel
!width="300"|Detail
!width="50"|Ported to 2.6
|- 
| init/do_mounts.c
| minor, mounting cramfs root
|
|-
| init/main.c
| interesting initialisation changes for USB. start_kernel pulls down USB, init pulls up USB. Also boot tracing mods and ssp_pcap_init called in in do_basic_setup
|
|-
| kernel/context.c
| minor change to context_thread for MV RT threading
|
|-
| kernel/printk.c
| minor changes for logging, new method logbuf_info
|
|-
| kernel/sched.c
| difficult to identify, large MV changes - backported Ingo Molnar work
|
|-
| lib/rwsem-spinlock.c
| minor new method for trying to get a read lock on a semaphore
|
|-
| mm/page_alloc.c
| minor changes, discontiguous memory support
|
|-
| mm/slab.c
| minor change to report potentially free pages slab_cache_freeable_info
|
|-
| net/core/sock.c
| minor change, commented out permission check for clients using raw sockets
|
|-
| net/ipv4/af_inet.c
| minor change, bind to port 500 for VPN
|
|-
| net/ipv4/devinet.c
| minor change, related to CSD calls, commented out permission check for CAP_NET_ADMIN
|
|-
| net/ipv4/fib_frontend.c
| minor change, related to CSD calls, commented out permission check for CAP_NET_ADMIN
|
|-
| net/ipv4/tcp_output.c
| minor SYN compatibility change
|
|-
| scripts/mkdep.c
| using newer version of mkdep compared with version in stock 2.4.20 kernel
|
|}


{| border="1" cellpadding="2"
!width="150"|arch/arm/..
!width="300"|Detail
!width="50"|Ported to 2.6
|- 
| boot/compressed/head-xscale.S
| minor, identification of MACH_TYPE_EZX
|
|- 
| config.in
| EZX config
|
|- 
| def-configs/ezx-680
| ezx-680 config
|
|- 
| kernel/head-armv.S
| PHYS_OFFSET for ezx
|
|- 
| mach-ezx/a780.c
| New files, potentially derived from Mainstone, Motorola EZX architecture definition
|
|- 
| mach-ezx/apm.c
| 
|
|- 
| mach-ezx/generic.c
| 
|
|- 
| mach-ezx/irq.c
| 
|
|- 
| mach-ezx/pm.c
| 
|
|- 
| mach-ezx/pxabus_ldm.c
| 
|
|- 
| mach-ezx/sleep.S
| 
|
|- 
| mach-ezx/usb_sw.c
| 
|
|- 
| mach-ezx/useroff.c
| 
|
|- 
| mach-pxa/sleep.S
| set BVD_MEMC_SIGHTING to 0
|
|- 
| mm/discontig.c
| minor, increased number of nodes for discontiguous memory
|
|- 
| mm/init.c
| minor, reserve first page for exiting sleep and user off mode
|
|}


{| border="1" cellpadding="2"
!width="80"|drivers/..
!width="300"|Detail
!width="50"|Ported to 2.6
|- 
| block/Config.in
| minor, inclusion of roflash config
|
|- 
| block/Makefile
| minor, include roflash subdir
|
|- 
| block/roflash/ezx_parts.c
| new file, ezx roflash partitions
|
|- 
| block/roflash/roflash.c
| Motorola read only block device driver for cramfs
|
|- 
| char/gpio_test.c
| equivalent to Harald's gpiotool, although also does USB overvoltage checks
|
|- 
| char/led_pxa_e680.c
| new file, led gpio handling
|
|- 
| char/n_tty.c
| minor change, throttling release for btuart. Also test_bit and set_bit param change
|
|- 
| char/sa1100-rtc.c
| unsure of changes, comment states add queue apm event
|
|- 
| char/serial.c
| number of changes, serial mux support - receive_chars calls serial_mux_dispatcher, btuart throttling (flip flow control), bt wakeup handling, ICL (mux) uart handling
|
|- 
| char/tty_io.c
| minor, bt uart flow control - queuing of task
| not required
|- 
| i2c/a780_camera.c
| new file
|
|- 
| i2c/boomer.c
| new file, appears to be AP to loudspeaker related
|
|- 
| i2c/e680_camera.c
| new file
|
|- 
| i2c/i2c-adap-pxa.c
| MV file, Motorola added pm suspend/resume hooks
|
|- 
| i2c/i2c-adcm2700.c
| new file, camera module
|
|- 
| i2c/i2c-adcm2700.h
| new file, camera module
|
|- 
| i2c/i2c-algo-pxa.c
| minor, disable pxa bus scanning
|
|- 
| media/video/adcm3800.c
| new file, camera module
|
|- 
| media/video/adcm3800.h
| new file, camera module
|
|- 
| media/video/adcm3800_hw.c
| new file, camera module
|
|- 
| media/video/adcm3800_hw.h
| new file, camera module
|
|- 
| media/video/camera.h
| new file, camera module
|
|- 
| media/video/ci.h
| new file, camera module
|
|- 
| media/video/e680_camera.c
| new file, camera module
|
|- 
| media/video/pxa_camera.c
| new file, camera module
|
|- 
| media/video/pxa_camera_micron.c
| new file, camera module
|
|- 
| media/video/pxa_camera_ov.c
| new file, camera module
|
|- 
| misc/Config.in
| minor change for keypad, keylight & fm radio configs
|
|- 
| misc/ezx-button.c
| new file, /dev/button read/write and button gpio handling
|
|- 
| misc/ezx-button.h
| new file
|
|- 
| misc/ezx-emu.c
| new file, EMU handling, uart/usb switching
|
|- 
| misc/ezx-emu.h
| new file, EMU handling, uart/usb switching
|
|- 
| misc/ezx-log.c
| new file, kernel panic logging
|
|- 
| misc/ezx-ts.c
| new file, touchscreen
|
|- 
| misc/ezx-ts.h
| new file, touchscreen
|
|- 
| misc/fmradio.c
| new file, fm radio i2c driver support 
|
|- 
| misc/fmradio.h
| new file, fm radio i2c driver support 
|
|- 
| misc/keylight.c
| new file, pcap keylight control
|
|- 
| misc/keylight.h
| new file, pcap keylight control
|
|- 
| misc/keypad-e398.c
| new file, /dev/keypad.. handling
|
|- 
| misc/keypad-panasonic.c
| new file, /dev/keypad.. handling
|
|- 
| misc/keypad.c
| new file, /dev/keypad.. handling
|
|- 
| misc/keypad.h
| new file, /dev/keypad.. handling
|
|- 
| misc/log.c
| new file, kernel panic logging
|
|- 
| misc/log.h
| new file, kernel panic logging
|
|- 
| misc/ssp_pcap.h
| new file, power control
|
|- 
| misc/ssp_pcap_main.c
| new file, power control - usb, ts, sleep/wakeup, headjack change, cable attach
|
|- 
| mtd/chips/cfi_cmdset_0001.c
| 
|
|- 
| mtd/chips/cfi_cmdset_0001_mp.c
| 
|
|- 
| mtd/chips/cfi_probe.c
| 
|
|- 
| mtd/maps/bulverde.c
| 
|
|- 
| mtd/maps/mbx860.c
| 
|
|- 
| mtd/maps/mot-mvp.c
| 
|
|- 
| mtd/maps/powerplus.c
| 
|
|- 
| net/ariadne.c
| 
|
|- 
| net/ariadne.h
| 
|
|- 
| net/bsd_comp.c
| 
|
|- 
| net/de4x5.c
| 
|
|- 
| net/defxx.c
| 
|
|- 
| net/ppp_async.c
| 
|
|- 
| net/ppp_deflate.c
| 
|
|- 
| net/ppp_generic.c
| 
|
|- 
| net/ibm_ocp/ibm_ocp_enet.c
| 
|
|- 
| net/ibm_ocp/ibm_ocp_phy.c
| 
|
|- 
| net/pcmcia/smc91c92_cs.c
| 
|
|- 
| net/skfp/h/supern_2.h
| 
|
|- 
| pci/pci.ids
| 
|
|- 
| pcmcia/m8xx_pcmcia.c
| 
|
|- 
| scsi/dpt/dptsig.h
| 
|
|- 
| serial/serial_8250_pnp.c
| 
|
|- 
| sound/Config.in
| 
|
|- 
| sound/ezx-a780.c
| 
|
|- 
| sound/ezx-a780.h
| 
|
|- 
| sound/ezx-asspm.c
| 
|
|- 
| sound/ezx-assps.c
| 
|
|- 
| sound/ezx-audio.c
| 
|
|- 
| sound/ezx-audio.h
| 
|
|- 
| sound/ezx-common.c
| 
|
|- 
| sound/ezx-common.h
| 
|
|- 
| sound/ezx-e680.c
| 
|
|- 
| sound/ezx-e680.h
| 
|
|- 
| sound/ezx-nssp.c
| 
|
|- 
| sound/ezx-phone.c
| 
|
|- 
| sound/ezx-vibrator.c
| 
|
|- 
| sound/ezx-vibrator.h
| 
|
|- 
| sound/msnd.h
| 
|
|- 
| sound/msnd_pinnacle.c
| 
|
|- 
| sound/sound_core.c
| 
|
|- 
| sound/wavfront.c
| 
|
|- 
| usb/dsplog_usb.c
| 
|
|- 
| usb/hub.c
| 
|
|- 
| usb/ipcusb.c
| 
|
|- 
| usb/ipcusb.h
| 
|
|- 
| usb/usb-ohci-wmmx.c
| 
|
|- 
| usb/usb-ohci.c
| 
|
|- 
| usb/usb.c
| 
|
|- 
| usbd/acm_fd/acm.c
| 
|
|- 
| usbd/acm_fd/trace.c
| 
|
|- 
| usbd/Config.in
| 
|
|- 
| usbd/Makefile
| 
|
|- 
| usbd/ep0.c
| 
|
|- 
| usbd/trace.c
| 
|
|- 
| usbd/trace.h
| 
|
|- 
| usbd/usbd-bi.c
| 
|
|- 
| usbd/usbd-bi.h
| 
|
|- 
| usbd/usbd-bops.c
| 
|
|- 
| usbd/usbd-func.h
| 
|
|- 
| usbd/usbd-procfs.c
| 
|
|- 
| usbd/usbd.c
| 
|
|- 
| usbd/usbdezx.c
| 
|
|- 
| usbd/cfg11_fd/Config.in
| 
|
|- 
| usbd/cfg11_fd/Makefile
| 
|
|- 
| usbd/cfg11_fd/cfg11.c
| 
|
|- 
| usbd/dsplog_fd/Config.in
| 
|
|- 
| usbd/dsplog_fd/Makefile
| 
|
|- 
| usbd/dsplog_fd/dsplog.c
| 
|
|- 
| usbd/network_fd/Makefile
| 
|
|- 
| usbd/network_fd/network.c
| 
|
|- 
| usbd/nm_fd/Config.in
| 
|
|- 
| usbd/nm_fd/Makefile
| 
|
|- 
| usbd/nm_fd/net_monitor.c
| 
|
|- 
| usbd/pst_fd/Config.in
| 
|
|- 
| usbd/pst_fd/Makefile
| 
|
|- 
| usbd/pst_fd/pst-fd.c
| 
|
|- 
| usbd/pst_fd/ptf_buf.c
| 
|
|- 
| usbd/pst_fd/ptf_buf.h
| 
|
|- 
| usbd/pst_fd/ptfproto.c
| 
|
|- 
| usbd/pst_fd/ptfproto.h
| 
|
|- 
| usbd/pxa_bi/Makefile
| 
|
|- 
| usbd/storage_fd/storage.c
| 
|
|- 
| usbd/wmmx_bi/Makefile
| 
|
|- 
| usbd/wmmx_bi/wmmx.c
| 
|
|- 
| video/clgenfb.c
| 
|
|- 
| video/fbcon.c
| 
|
|- 
| video/fbmem.c
| 
|
|- 
| video/inflate.c
| 
|
|- 
| video/misc.c
| 
|
|- 
| video/pxafb.c
| 
|
|- 
| video/pxafb.h
|
|
|}


{| border="1" cellpadding="2"
!width="150"|fs/..
!width="300"|Detail
!width="50"|Ported to 2.6
|- 
| super.c
| 
|
|- 
| cramfs/inode.c
| 
|
|- 
| fat/fatfs_syms.c
| 
|
|- 
| fat/inode.c
| 
|
|- 
| fat/misc.c
| 
|
|- 
| proc/proc_misc.c
| 
|
|- 
| vfat/namei.c
|
|
|}


{| border="1" cellpadding="2"
!width="150"|include/..
!width="300"|Detail
!width="50"|Ported to 2.6
|- 
| asm-arm/ioctls.h
| 
|
|- 
| asm-arm/memory.h
| 
|
|- 
| asm-arm/termios.h
| 
|
|- 
| asm-arm/arch-mx1ads/platform.h
| 
|
|- 
| asm-arm/arch-pxa/ezx.h
| 
|
|- 
| asm-arm/arch-pxa/hardware.h
| 
|
|- 
| asm-arm/arch-pxa/irq.h
| 
|
|- 
| asm-arm/arch-pxa/irqs.h
| 
|
|- 
| asm-arm/arch-pxa/keypad.h
| 
|
|- 
| asm-arm/arch-pxa/memory.h
| 
|
|- 
| asm-arm/arch-pxa/pxa-regs.h
| 
|
|- 
| asm-arm/arch-pxa/system.h
| 
|
|- 
| asm-arm/arch-pxa/uncompress.h
| 
|
|- 
| asm-arm/arch-sa1100/SA-1100.h
| 
|
|- 
| linux/apm_bios.h
| 
|
|- 
| linux/cramfs_fs_sb.h
| 
|
|- 
| linux/ezx_roflash.h
| 
|
|- 
| linux/ezxusbd.h
| 
|
|- 
| linux/fb.h
| 
|
|- 
| linux/keypad.h
| 
|
|- 
| linux/led_pxa_e680.h
| 
|
|- 
| linux/mc146818rtc.h
| 
|
|- 
| linux/mc6821.h
| 
|
|- 
| linux/miscdevice.h
| 
|
|- 
| linux/ppp-comp.h
| 
|
|- 
| linux/ppp_channel.h
| 
|
|- 
| linux/pxa_camera.h
| 
|
|- 
| linux/rwsem.h
| 
|
|- 
| linux/serial.h
| 
|
|- 
| linux/serialP.h
| 
|
|- 
| linux/soundcard.h
| 
|
|- 
| linux/sysctl.h
| 
|
|- 
| linux/tty.h
| 
|
|- 
| linux/tty_driver.h
| 
|
|- 
| linux/vibrator.h
| 
|
|- 
| linux/videodev.h
| 
|
|- 
| linux/mmc/mmc_ll.h
| 
|
|- 
| linux/mmc/mmc_protocol.h
| 
|
|- 
| linux/mtd/map.h
|
|
|}
