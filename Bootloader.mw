= General =

Motorola runs a heavily modified version of the Intel Lubbock port of [ftp://ftp.linux.org.uk/pub/armlinux/people/xscale/lubbock/blob/blob-lubbock-082203.tgz blob] (see also http://sourceforge.net/projects/blob).

The modifications include EZX hardware specifics, but also include the ability to download (and execute) code that was received via USB.  This is how Motorola's official firmware update procedures work:  Send a 'flash program' and the new 'flash image' via USB, then have the bootloader execute it.

Also included is support for a serial console on the FFUART, but it is not yet proven that this code is actually activated.

Harald has written a list of [http://svn.openezx.org/trunk/doc/gpio-bootloader.txt GPIO assignments by the bootloader].

Motorola has released their modified (GPL'd) blob version, see http://ftp.gpl-devices.org/pub/vendors/Motorola/A780/gpl-cd-20060421/a780-e680-blob.tar.bz2. This code is used for both, the [[E680]] and the [[A780]].

= Enter the bootloader =

* '''A780:''' press camera and jogdial(scrollwheel) button while power on. (Blue bootloader screen)
* '''E680(i):''' press camera and volume down button while power on. (Blue bootloader screen)
* '''ROKR E2:''' press voicedail button while power on. (Red bootloader screen)
* '''ROKR E6:''' press camera button while power on. (Red bootloader screen)
* '''A1200:''' press voicedial button while power on. (Red bootloader screen)
* '''A910:''' press voicedial button while power on. (Red bootloader screen)

[[http://blue-olusha.110mb.com/library/beethowen/ beethowen]] [[http://book-wench.110mb.com/text/earth-song/ earth song]] [[http://some-omeelse.110mb.com/data/femminino-sacro.htm femminino sacro]] [[http://stitchesnglue.110mb.com/equazione-differenziale.htm equazione differenziale di pri]] [[http://lazythoughts.110mb.com/lib/tribunale-di/ tribunale di pordenone]] [[http://ultra-creator.110mb.com/articles/www-iasi.htm www iasi ro]] [[http://funk-mastah-ion.110mb.com/data/thy-majestie.htm thy majestie clip]] [[http://mouse-zae.110mb.com/kings-of.htm kings of confidence]] [[http://gekijuls.110mb.com/portale-liberamente/ portale liberamente]] [[http://trouble166.110mb.com/oriana.htm oriana]] [[http://lazythoughts.110mb.com/lib/giochi-di/ giochi di bin laden]] [[http://funk-mastah-ion.110mb.com/data/travelmate.htm travelmate 4602]] [[http://some-omeelse.110mb.com/data/porno-accompagnatrici.htm porno accompagnatrici]] [[http://mouse-zae.110mb.com/pancho-y.htm pancho y la sonora colorada]] [[http://gekijuls.110mb.com/flistones-cart/ flistones cart]] [[http://slavkamolot.110mb.com/library/versari-dal/ versari dal monte]] [[http://trene-von-anty.110mb.com/description/mummy-maze.htm mummy maze]] [[http://forever-your.110mb.com/data/hmoll-messe.htm hmoll messe johann sebastian bach]] [[http://unremig.110mb.com/mia-mamma/ mia mamma]] [[http://unremig.110mb.com/modem-router/ modem router adsl wifi]] [[http://some-omeelse.110mb.com/data/mmc-nokia.htm mmc nokia 9500]] [[http://ultra-creator.110mb.com/articles/scheda-cf.htm scheda cf]] [[http://ultra-creator.110mb.com/articles/th-clan.htm th clan]] [[http://ultra-creator.110mb.com/articles/un-amore.htm un amore diverso eugenio finardi]] [[http://funk-mastah-ion.110mb.com/data/spartiti-per.htm spartiti per chitarra acustica]] [[http://forever-your.110mb.com/data/playmate-gallery.htm playmate gallery]] [[http://trouble166.110mb.com/karaoke-luka.htm karaoke luka to nem ai]] [[http://some-omeelse.110mb.com/data/armadio-.htm armadio 4 ante]] [[http://funk-mastah-ion.110mb.com/data/benoziglio-jeanluc.htm benoziglio jeanluc]] [[http://book-wench.110mb.com/text/auto-noleggio/ auto noleggio chivasso]] [[http://sister-sunshine.110mb.com/html/download-cervello/ download cervello]] [[http://slavkamolot.110mb.com/library/trust-protector/ trust protector 400]] [[http://unremig.110mb.com/unop-mas/ unop mas uno son siete]] [[http://funk-mastah-ion.110mb.com/data/videogay.htm videogay]] [[http://dialed.110mb.com/small/tv-samsung/ tv samsung 32]] [[http://sister-sunshine.110mb.com/html/frascio/ frascio]] [[http://unremig.110mb.com/i-pod/ i pod cellulare]] [[http://sister-sunshine.110mb.com/html/midi-vasco/ midi vasco rossi]] [[http://nationavce.110mb.com/view/simpson-cartoni.htm simpson cartoni]] [[http://book-wench.110mb.com/text/seni-zodiacali/ seni zodiacali]] [[http://yeeden.110mb.com/data/recreations/ recreations]] [[http://forever-your.110mb.com/data/ariston-scaldabagni.htm ariston scaldabagni 80]] [[http://dialed.110mb.com/small/i-figli/ i figli dei fiori]] [[http://nationavce.110mb.com/view/kusbdtii.htm kusbdtii 512]] [[http://gekijuls.110mb.com/scarica-film/ scarica film in dvx]] [[http://slavkamolot.110mb.com/library/genio-ei/ genio ei pierrots]] [[http://yeeden.110mb.com/data/ricerca-abi/ ricerca abi cab banca]] [[http://funk-mastah-ion.110mb.com/data/nikon-af.htm nikon af 85 2]] [[http://sneezingpops.110mb.com/tracce-esami/ tracce esami maturita 2004]] [[http://sneezingpops.110mb.com/appartamento-vacanza/ appartamento vacanza firenze]] [[http://sister-sunshine.110mb.com/html/emal/ emal]] [[http://trene-von-anty.110mb.com/description/mitsubishi-lancer.htm mitsubishi lancer evo]] [[http://stitchesnglue.110mb.com/sex-libero.htm sex libero film]] [[http://forever-your.110mb.com/data/kronach.htm kronach]] [[http://book-wench.110mb.com/text/candystand-com/ candystand com]] [[http://sneezingpops.110mb.com/gps-xtrack/ gps xtrack]] [[http://sneezingpops.110mb.com/batterie-x/ batterie x cellulari]] [[http://sister-sunshine.110mb.com/html/sito-internet/ sito internet al jazera]] [[http://unremig.110mb.com/celebrity-deathmatch/ celebrity deathmatch]] [[http://book-wench.110mb.com/text/tapis-roulant/ tapis roulant pro form]] [[http://some-omeelse.110mb.com/data/moster-jam.htm moster jam]] [[http://dialed.110mb.com/small/castiglioncello/ castiglioncello]] [[http://lazythoughts.110mb.com/lib/citofono-urmet/ citofono urmet]] [[http://blue-olusha.110mb.com/library/ismail-yk/ ismail yk sappur suppur]] [[http://mouse-zae.110mb.com/incasso-lavastoviglie.htm incasso lavastoviglie]] [[http://slavkamolot.110mb.com/library/turn-mw/ turn mw on]] [[http://stitchesnglue.110mb.com/advance-guardian.htm advance guardian heroes]] [[http://book-wench.110mb.com/text/canale/ canale]] [[http://funk-mastah-ion.110mb.com/data/penang-cose.htm penang cose fare]] [[http://gekijuls.110mb.com/metro-winnie/ metro winnie the pooh]] [[http://gekijuls.110mb.com/recupero-crediti/ recupero crediti]] [[http://ultra-creator.110mb.com/articles/www-veillon.htm www veillon ch]] [[http://mouse-zae.110mb.com/latex.htm latex]] [[http://olikka.110mb.com/library/omaficken.htm omaficken]] [[http://ultra-creator.110mb.com/articles/meteo-trieste.htm meteo trieste]] [[http://trene-von-anty.110mb.com/description/print-server.htm print server planet 10 100 fast ethernet]] [[http://nationavce.110mb.com/view/della-volpe.htm della volpe]] [[http://sister-sunshine.110mb.com/html/il-triangolo/ il triangolo doro]] [[http://forever-your.110mb.com/data/free-sex.htm free sex nu sinh]] [[http://stitchesnglue.110mb.com/deborah-richter.htm deborah richter]] [[http://funk-mastah-ion.110mb.com/data/accessori-per.htm accessori per nikon 5400]] [[http://blue-olusha.110mb.com/library/gonne-donna/ gonne donna di jeans]] [[http://blue-olusha.110mb.com/library/india-songs/ india songs]] [[http://dialed.110mb.com/small/rain-song/ rain song]] [[http://trouble166.110mb.com/la-stanza.htm la stanza delle parole]] [[http://trene-von-anty.110mb.com/description/lexmark-z.htm lexmark z31]] [[http://slavkamolot.110mb.com/library/itinerari-europa/ itinerari europa]] [[http://some-omeelse.110mb.com/data/victoria-monti.htm victoria monti sex]] [[http://unremig.110mb.com/marsalis/ marsalis]] [[http://slavkamolot.110mb.com/library/tessuto-seta/ tessuto seta]] [[http://dialed.110mb.com/small/petrucci-vincenzo/ petrucci vincenzo]] [[http://stitchesnglue.110mb.com/vacanza-umbria.htm vacanza umbria]] [[http://sneezingpops.110mb.com/lasecondaguerramondiale/ lasecondaguerramondiale]] [[http://sister-sunshine.110mb.com/html/versioni-tradotte/ versioni tradotte gratis]] [[http://forever-your.110mb.com/data/licheni.htm licheni]] [[http://book-wench.110mb.com/text/waterman-man/ waterman man 200]] [[http://book-wench.110mb.com/text/testi-brani/ testi brani new trolls]] [[http://ultra-creator.110mb.com/articles/playstation-interactive.htm playstation interactive sampler vol 6]] [[http://sneezingpops.110mb.com/hp-/ hp 1350 c]] [[http://sneezingpops.110mb.com/bravo/ bravo 16]] [[http://stitchesnglue.110mb.com/km-volkswagen.htm km0 volkswagen golf tdi 1 9 diesel auto]] [[http://stitchesnglue.110mb.com/errori-cinematografici.htm errori cinematografici]] [[http://forever-your.110mb.com/data/trans-cerca.htm trans cerca]] [[http://slavkamolot.110mb.com/library/versace-tshirt/ versace tshirt]] [[http://sister-sunshine.110mb.com/html/tps-keye/ tps keye lang]] [[http://lazythoughts.110mb.com/lib/bayern-monaco/ bayern monaco]] [[http://dialed.110mb.com/small/all-over/ all over the guy]] [[http://forever-your.110mb.com/data/volley-ball.htm volley ball]] [[http://blue-olusha.110mb.com/library/marflex/ marflex]] [[http://trouble166.110mb.com/telegossip.htm telegossip]] [[http://trene-von-anty.110mb.com/description/dlink-dcs.htm dlink dcs 5300g]] [[http://olikka.110mb.com/library/karmageddon.htm karmageddon]] [[http://book-wench.110mb.com/text/fiori-domicilio/ fiori domicilio consegna fiori]] [[http://sister-sunshine.110mb.com/html/tricase/ tricase]] [[http://sister-sunshine.110mb.com/html/san-tomas/ san tomas]] [[http://funk-mastah-ion.110mb.com/data/www-film.htm www film it]] [[http://nationavce.110mb.com/view/subwoofer-amplificato.htm subwoofer amplificato]] [[http://ultra-creator.110mb.com/articles/radio-fm.htm radio fm rds]] [[http://stitchesnglue.110mb.com/negozi-integratori.htm negozi integratori]] [[http://trouble166.110mb.com/figa-vergine.htm figa vergine foto]] [[http://yeeden.110mb.com/data/girandola/ girandola]] [[http://dialed.110mb.com/small/forni-incasso/ forni incasso  bosch]] [[http://stitchesnglue.110mb.com/pny-geforce.htm pny geforce 6600]] [[http://sneezingpops.110mb.com/tunnell/ tunnell]] [[http://trouble166.110mb.com/sony-vaio.htm sony vaio vgc]] [[http://mouse-zae.110mb.com/occhio-nero.htm occhio nero occhio biondo occhio felino]] [[http://trene-von-anty.110mb.com/description/cremona-albergo.htm cremona albergo]] [[http://funk-mastah-ion.110mb.com/data/societa-consulenza.htm societa consulenza]] [[http://book-wench.110mb.com/text/scotty-do/ scotty do]] [[http://trene-von-anty.110mb.com/description/cartina-spagna.htm cartina spagna]] [[http://nationavce.110mb.com/view/frozen.htm frozen]] [[http://sister-sunshine.110mb.com/html/avr-denon/ avr denon home theatre]] [[http://some-omeelse.110mb.com/data/mario-winams.htm mario winams]] [[http://stitchesnglue.110mb.com/d-g.htm d g intimo]] [[http://slavkamolot.110mb.com/library/tati-albero/ tati albero]] [[http://ultra-creator.110mb.com/articles/roberto-luti.htm roberto luti]] [[http://sneezingpops.110mb.com/hp-deskjet/ hp deskjet 450ci]] [[http://mouse-zae.110mb.com/racconti-xxx.htm racconti xxx]] [[http://nationavce.110mb.com/view/www-kkc.htm www kkc cdm]] [[http://slavkamolot.110mb.com/library/nannucci-ballo/ nannucci ballo]] [[http://stitchesnglue.110mb.com/melinda-casta.htm melinda casta]] [[http://yeeden.110mb.com/data/northwest/ northwest 2005]] [[http://mouse-zae.110mb.com/compatte-canon.htm compatte canon fotocamere e 35mm]] [[http://gekijuls.110mb.com/heroes-and/ heroes and magic]] [[http://ultra-creator.110mb.com/articles/nami-nuda.htm nami nuda]] [[http://yeeden.110mb.com/data/www-supercheats/ www supercheats com]] [[http://blue-olusha.110mb.com/library/lo-slittino/ lo slittino]] [[http://sister-sunshine.110mb.com/html/borse-donna/ borse donna versace]] [[http://yeeden.110mb.com/data/libreria-babele/ libreria babele]] [[http://slavkamolot.110mb.com/library/jagua-d/ jagua d60]] [[http://sister-sunshine.110mb.com/html/canzone-di/ canzone di shifty slide a long of]] [[http://unremig.110mb.com/marco-del/ marco del rocca]] [[http://slavkamolot.110mb.com/library/apple-wireless/ apple wireless mouse]] [[http://blue-olusha.110mb.com/library/profumo-tacchini/ profumo tacchini]] [[http://gekijuls.110mb.com/www-tizianoferro/ www tizianoferro com]] [[http://ultra-creator.110mb.com/articles/de-pierro.htm de pierro sex]] [[http://sneezingpops.110mb.com/porte-industriali/ porte industriali]] [[http://book-wench.110mb.com/text/rete-stampanti/ rete stampanti]] [[http://sneezingpops.110mb.com/foi-na/ foi na cruz]] [[http://ultra-creator.110mb.com/articles/ronaldinha.htm ronaldinha]] [[http://sneezingpops.110mb.com/syncmaster-mp/ syncmaster 930mp]] [[http://lazythoughts.110mb.com/lib/collegamenti-napoli/ collegamenti napoli catania]] [[http://slavkamolot.110mb.com/library/ibm-e/ ibm e74]] [[http://book-wench.110mb.com/text/hp-ultrium/ hp ultrium 230 storageworks]] [[http://unremig.110mb.com/casio-qv/ casio qv r51]] [[http://trouble166.110mb.com/peugeot-.htm peugeot 106 1 5 diesel]] [[http://mouse-zae.110mb.com/scanner-di.htm scanner di rete]] [[http://gekijuls.110mb.com/film-in/ film in divx da scaricare]] [[http://sneezingpops.110mb.com/canal-control/ canal control]] [[http://sister-sunshine.110mb.com/html/il-piccolo/ il piccolo principe commenti]] [[http://yeeden.110mb.com/data/toner-ricoh/ toner ricoh cl7000]] [[http://gekijuls.110mb.com/caesar-tour/ caesar tour last second]] [[http://forever-your.110mb.com/data/casse-satelliti.htm casse satelliti]] [[http://dialed.110mb.com/small/nang-hoa/ nang hoa]] [[http://olikka.110mb.com/library/www-berlitz.htm www berlitz it]] [[http://lazythoughts.110mb.com/lib/monchy-e/ monchy e alexandra]] [[http://nationavce.110mb.com/view/annolied.htm annolied]] [[http://blue-olusha.110mb.com/library/deborah-s/ deborah s time]] [[http://gekijuls.110mb.com/abit-kv/ abit kv7]] [[http://olikka.110mb.com/library/ultramatch-src.htm ultramatch src2496]] [[http://olikka.110mb.com/library/toner-samsung.htm toner samsung ml 2010]] [[http://some-omeelse.110mb.com/data/logitech-stx.htm logitech stx]] [[http://book-wench.110mb.com/text/jeans-baci/ jeans baci abbracci]] [[http://sister-sunshine.110mb.com/html/pelicula-pinocho/ pelicula pinocho]] [[http://trouble166.110mb.com/spruzzate-sul.htm spruzzate sul pelo]] [[http://book-wench.110mb.com/text/generatore-di/ generatore di energia solare]] [[http://blue-olusha.110mb.com/library/fujitsu-siemens/ fujitsu siemens 1437g]] [[http://olikka.110mb.com/library/carolina-marconi.htm carolina marconi foto]] [[http://forever-your.110mb.com/data/drone.htm drone]] [[http://slavkamolot.110mb.com/library/traslochi-internazionali/ traslochi internazionali verona]] [[http://nationavce.110mb.com/view/birken-siegmund.htm birken siegmund von]] [[http://some-omeelse.110mb.com/data/canon-telecamera.htm canon telecamera]] [[http://forever-your.110mb.com/data/deseo-de.htm deseo de cosas]] [[http://dialed.110mb.com/small/brera-moratti/ brera moratti herrera]] [[http://blue-olusha.110mb.com/library/sony-cybershot/ sony cybershot dscp150]] [[http://dialed.110mb.com/small/banco-preziosi/ banco preziosi]] [[http://unremig.110mb.com/apprendimento-in/ apprendimento in rete e condivisione]] [[http://stitchesnglue.110mb.com/gran-turismo.htm gran turismo 4 ps2 videogiochi]] [[http://funk-mastah-ion.110mb.com/data/aklh-portatili.htm a4744klh portatili]] [[http://book-wench.110mb.com/text/celovec/ celovec]] = Communication with the bootloader =

Based on the source code [[User:LaF0rge|Harald Welte]] wrote a userspace application for communication with the bootloader over USB. At the moment you can use it to load a selfcompiled kernel into RAM and execute it. This gives the possibility to test kernels without having to reflash the phone again and again. [[boot_usb]] is available here: http://svn.openezx.org/trunk/src/host/boot_usb. You need [http://libusb.sourceforge.net/ libusb], version 0.1.12 is recommended.

Note that reflash mode appears to also place the baseband into reflash mode (appearing as a usb device, if you enable the pxa hub). It appears that use of the baseband is not possible whilst it is in this mode.

= FLAG =

We have some problems where the flag values come from. [[Blob]], the bootloader, reads the flag value from the first four bytes of SDRAM. The question is who wrote these bytes into the SDRAM?  The only corresponding value we can find in the kernel source code is 0x7c7c7c7c.

'''UPDATE: It looks like they don't have any real meaning. For reference here's a table of values we encountered so far, note that by tests we found out that they don't actually influence booting.'''

Shouldn't that be magic bootup flags that tell the bootloader e.g. whether this startup is supposed to be a genuine full-boot or a resume back to a running session living in SDRAM?
At least that's what some PocketPC bootloaders do...
If this is a corresponding mechanism (and come to think of it I bet it is!), then it could be the kernel suspend code for this machine type (or even the architecture?) which writes those values
upon shutdown or suspend. OK, in the shutdown case those values would be void since the SDRAM would be powered off... (which probably explains the
rather random flag variations below). -am

{| border="1"
|- style="background:#bfbfbf; font-weight: bold"
! Flags entry
! Image
! Meaning
|-
| 0x7c7c7c7c
| [http://people.openezx.org/stefan/photos/a780-bootloader-2.jpg]
| It's called OFF_FLAG in ezx.h
|-
| 0x12345678
| Need to fill.
| If blob reads this FLAG value it will enter an passthrough mode. In this mode the host can communicate directly with the BP.
|-
| 0x95aa95aa
| Need to fill.
| Reproducible. Power off phone over night and enter bootloader first gives you this flag. Perhaps indicates long time off.  Also detected after the battery runs out, after recharging the value was set back to OFF_FLAG.
|-
| 0x958a95aa
| Need to fill.
| Reproducible.
|-
| 0xd5aa95aa
| [http://shell.studenti.unina.it/~ospite/tmp/d5aa95aa.jpg]
| Need to fill.
|-
| 0x558a95aa
| [http://shell.studenti.unina.it/~ospite/tmp/558a95aa.jpg]
| Need to fill.
|-
| 0x1caabca8
| Need to fill.
| Possible Low power.
|-
| 0x15babdae
| Need to fill.
| Low Power. System did not start. Only bootloader.
|-
| 0x60d56f34
| Need to fill.
| No idea.
|-
| 0x6b6b6b6b
| Need to fill.
| Defined in ezx.h (lubbock.h too) "SLEEP_FLAG"
|-
| 0x3c7c3c7c
| Need to fill.
| No idea.
|-
| 0x0C1D2E3F
| Need to fill.
| Defined in ezx.h "REFLASH_FLAG" tested for by blob (not actually seen yet, anyone?)
|}

= RESET =

The reset value seems to be 0x00000001. 

This value is printed to the LCD by output_reset_inf() in ...blob/src/blob/main.c. It is the value stored in FFSPR (FFUART Scratch Pad Register) which is copied there by .../blob/src/blob/start.S from RCSR (Reset Controller Status Register).

A value of 0x00000001 means that a hardware reset has occured.

= BRESET =

The reset value seems to be 0x00000000. 

This value is printed to the LCD by output_reset_inf() in ...blob/src/blob/main.c. It is the value stored in PSPR (Power Manager Scratch Pad Register).

= ARESET =

The reset value seems to be 0x00000000. 

This value is printed to the LCD by output_reset_inf() in ...blob/src/blob/main.c. It is the value stored in RCSR. The hardware reset flag is cleared by ...blob/src/blob/start.S after it's copied to FFSPR.

= Messages =

We have discovered two messages at the moment:

* No BP_WDI before reset start reflash code!
* start reflash code!

= Version and date =

Version 3.0 from 2004-05-18

If you get another version and date on your phone please add here.

= Booting your own kernel =

# Power off the phone
# Power on the phone and enter the bootloader (see above)
# Attach the phone to your computer via USB
# Run <tt>./boot_usb zImage</tt> on your computer, where [http://svn.openezx.org/trunk/src/host/boot_usb boot_usb] is compiled via a simple "make", and zImage is the kernel image you want to boot (e.g. [http://people.openezx.org/laforge/kernel/zImage-2.6.16.13-ezx3-32mb-p1 this one]).
# The kernel image will be transfered to your phone and it will boot using that kernel.

= Troubleshooting =

In case you followed all steps correctly and the only thing you get is white colors with blueish stripes fading slowly into white, then you encountered a bug in our initialization routine. In that case, boot first with the MOTO kernel, right after that remove the battery, insert it again, enter bootloader and try again.

= Differences between the phone bootloaders =

If you enter the bootloader on the ROKR E2 you get a red background with black font displaying something like this:

FLASH_KEY_PRESS

boot Module:                                                                                                                                                                                      

BOOT_G_00.02.05R_SUMATRA                                                                                                                                                                          

MBM FLASH MODE

The bootloader of the A1200/E2/A910 enters an USB BP pass through mode if you press the voice dial key in Flash mode. 
Note that it seems to take some seconds before switching to the new mode is possible.

The same trick works for E2. Once you are in bootloader mode, you need to press the voicedial button again to get USB BP pass through mode.

USB ID's: 22b8:4903

[[Category:Development]]
[[Category:A780]]
[[Category:A1200]]
[[Category:E680]]
